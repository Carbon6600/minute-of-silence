<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–•–≤–∏–ª–∏–Ω–∞ –º–æ–≤—á–∞–Ω–Ω—è</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            font-size: clamp(10px, 2.5vw, 16px);
        }

        body {
            background: #0a0a0a;
            color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            min-height: 100dvh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }

        .container {
            text-align: center;
            z-index: 10;
            position: relative;
            width: 100%;
            max-width: 100vw;
            padding: clamp(10px, 3vw, 20px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            gap: clamp(20px, 5vh, 40px);
        }

        /* –°—Ç–∞—Ç—É—Å Wake Lock */
        .wakelock-status {
            position: fixed;
            top: clamp(10px, 3vh, 20px);
            right: clamp(10px, 3vw, 20px);
            font-size: clamp(0.65rem, 2.5vw, 0.75rem);
            color: #555;
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(0,0,0,0.5);
            padding: 5px 10px;
            border-radius: 12px;
            backdrop-filter: blur(4px);
            z-index: 100;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .wakelock-status.active {
            opacity: 1;
        }

        .wakelock-dot {
            width: clamp(6px, 2vw, 8px);
            height: clamp(6px, 2vw, 8px);
            border-radius: 50%;
            background: #333;
            transition: background 0.3s;
        }

        .wakelock-dot.on {
            background: #00d4ff;
            box-shadow: 0 0 10px #00d4ff;
            animation: pulse-blue 2s infinite;
        }

        @keyframes pulse-blue {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* –ì–æ–¥–∏–Ω–Ω–∏–∫ */
        .clock-container {
            position: relative;
            width: 100%;
            flex-shrink: 0;
        }

        .clock {
            font-size: clamp(3.5rem, 14vw, 8rem);
            font-weight: 200;
            letter-spacing: 0.05em;
            font-variant-numeric: tabular-nums;
            text-shadow: 0 0 30px rgba(255,255,255,0.1);
            font-family: 'Courier New', monospace;
            line-height: 1;
            white-space: nowrap;
        }

        .clock::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: min(200px, 50vw);
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
        }

        .date-display {
            font-size: clamp(0.85rem, 3.5vw, 1.1rem);
            color: #888;
            margin-top: clamp(15px, 4vh, 25px);
            text-transform: uppercase;
            letter-spacing: 0.2em;
            line-height: 1.4;
        }

        /* –ü–ª–µ—î—Ä */
        .player-container {
            background: #111;
            border: 1px solid #333;
            border-radius: clamp(10px, 3vw, 16px);
            padding: clamp(15px, 5vw, 25px);
            width: min(92%, 480px);
            box-shadow: 0 15px 50px rgba(0,0,0,0.9);
            flex-shrink: 0;
            margin: 0 auto;
            position: relative;
        }

        .track-header {
            display: flex;
            align-items: center;
            gap: clamp(12px, 4vw, 18px);
            margin-bottom: clamp(12px, 4vw, 18px);
        }

        .play-btn {
            width: clamp(52px, 15vw, 64px);
            height: clamp(52px, 15vw, 64px);
            border-radius: 50%;
            background: #f50;
            border: none;
            color: white;
            font-size: clamp(20px, 6vw, 24px);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
            touch-action: manipulation;
            box-shadow: 0 4px 20px rgba(255, 85, 0, 0.4);
        }

        .play-btn:hover, .play-btn:active {
            transform: scale(1.08);
            background: #ff6b35;
            box-shadow: 0 6px 25px rgba(255, 85, 0, 0.5);
        }

        .play-btn:disabled {
            background: #333;
            box-shadow: none;
            cursor: wait;
        }

        .track-info {
            text-align: left;
            flex: 1;
            min-width: 0;
        }

        .track-title {
            font-size: clamp(1rem, 4.5vw, 1.2rem);
            color: #fff;
            margin-bottom: 6px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-weight: 600;
        }

        .track-artist {
            font-size: clamp(0.8rem, 3.5vw, 0.9rem);
            color: #aaa;
        }

        /* Canvas –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –∑ –ø—Ä–æ–≥—Ä–µ—Å-–±–∞—Ä–æ–º */
        .visualizer-container {
            position: relative;
            height: clamp(70px, 20vw, 110px);
            background: #0a0a0a;
            border-radius: 6px;
            overflow: hidden;
            margin: clamp(10px, 3vw, 15px) 0;
            cursor: pointer;
            border: 1px solid #222;
        }

        #visualizer {
            width: 100%;
            height: 100%;
            display: block;
        }

        .progress-line {
            position: absolute;
            top: 0;
            left: 0;
            width: 2px;
            height: 100%;
            background: #fff;
            box-shadow: 0 0 10px rgba(255,255,255,0.8);
            pointer-events: none;
            z-index: 10;
        }

        .visualizer-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #666;
            font-size: clamp(0.75rem, 3vw, 0.9rem);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            text-align: center;
            white-space: nowrap;
        }

        .visualizer-container:not(.playing) .visualizer-overlay {
            opacity: 1;
        }

        /* –ß–∞—Å */
        .time-display {
            display: flex;
            justify-content: space-between;
            font-size: clamp(0.75rem, 3vw, 0.85rem);
            color: #666;
            font-variant-numeric: tabular-nums;
            margin-top: 8px;
            padding: 0 5px;
        }

        .status-message {
            margin-top: clamp(10px, 3vw, 15px);
            padding: clamp(10px, 3vw, 12px);
            background: rgba(255, 85, 0, 0.1);
            border: 1px solid rgba(255, 85, 0, 0.3);
            border-radius: 6px;
            font-size: clamp(0.8rem, 3.5vw, 0.9rem);
            color: #f50;
            display: none;
            line-height: 1.4;
        }

        .status-message.active {
            display: block;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ GitHub */
        .github-link {
            position: fixed;
            bottom: clamp(15px, 4vh, 25px);
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.05);
            padding: 10px 20px;
            border-radius: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .github-link:hover, .github-link:active {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateX(-50%) translateY(-2px);
        }

        .github-icon {
            width: 20px;
            height: 20px;
            fill: #fff;
            opacity: 0.8;
        }

        .github-text {
            color: #aaa;
            font-size: clamp(0.75rem, 3vw, 0.85rem);
            font-weight: 500;
        }

        /* –§–æ–Ω */
        .bg-gradient {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, #1a1a1a 0%, #000 100%);
            z-index: 1;
        }

        .sync-status {
            position: fixed;
            bottom: clamp(60px, 12vh, 80px);
            right: clamp(10px, 3vw, 20px);
            font-size: clamp(0.65rem, 2.5vw, 0.75rem);
            color: #555;
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(0,0,0,0.5);
            padding: 5px 10px;
            border-radius: 12px;
            backdrop-filter: blur(4px);
        }

        .sync-dot {
            width: clamp(6px, 2vw, 8px);
            height: clamp(6px, 2vw, 8px);
            border-radius: 50%;
            background: #333;
            transition: background 0.3s;
        }

        .sync-dot.synced {
            background: #0f0;
            box-shadow: 0 0 10px #0f0;
        }

        .sync-dot.syncing {
            background: #ff0;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* –ü—Ä–∏—Ö–æ–≤–∞–Ω–µ –≤—ñ–¥–µ–æ –¥–ª—è iOS Wake Lock */
        .hidden-video {
            position: absolute;
            width: 1px;
            height: 1px;
            opacity: 0;
            pointer-events: none;
        }

        /* –ê–ª—å–±–æ–º–Ω–∞ –æ—Ä—ñ—î–Ω—Ç–∞—Ü—ñ—è */
        @media (orientation: landscape) and (max-height: 500px) {
            .container {
                flex-direction: row;
                gap: 30px;
                padding: 15px;
            }
            
            .clock-container {
                flex: 1;
            }
            
            .player-container {
                width: min(45%, 380px);
                flex-shrink: 0;
            }
            
            .clock {
                font-size: clamp(2.5rem, 10vh, 4rem);
            }
            
            .github-link {
                bottom: 10px;
            }
            
            .sync-status {
                bottom: 50px;
            }
            
            .wakelock-status {
                top: 10px;
            }
        }

        @media (max-width: 320px) {
            .clock {
                font-size: 2.5rem;
            }
            
            .visualizer-container {
                height: 60px;
            }
        }
    </style>
</head>
<body>
    <div class="bg-gradient"></div>

    <!-- –°—Ç–∞—Ç—É—Å Wake Lock -->
    <div class="wakelock-status" id="wakelockStatus">
        <span>–ï–∫—Ä–∞–Ω:</span>
        <div class="wakelock-dot" id="wakelockDot"></div>
        <span id="wakelockText">–ê–≤—Ç–æ</span>
    </div>

    <div class="container">
        <!-- –ì–æ–¥–∏–Ω–Ω–∏–∫ -->
        <div class="clock-container">
            <div class="clock" id="clock">00:00:00</div>
            <div class="date-display" id="date">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
        </div>

        <!-- –ü–ª–µ—î—Ä -->
        <div class="player-container">
            <div class="track-header">
                <button class="play-btn" id="playBtn" aria-label="–í—ñ–¥—Ç–≤–æ—Ä–∏—Ç–∏">‚ñ∂</button>
                <div class="track-info">
                    <div class="track-title">–•–≤–∏–ª–∏–Ω–∞ –º–æ–≤—á–∞–Ω–Ω—è</div>
                    <div class="track-artist">–©–æ–¥–µ–Ω–Ω–∞ –ø–∞–º'—è—Ç—å</div>
                </div>
            </div>

            <div class="visualizer-container" id="visualizerContainer">
                <canvas id="visualizer"></canvas>
                <div class="progress-line" id="progressLine" style="left: 0%"></div>
                <div class="visualizer-overlay">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å ‚ñ∂ –¥–ª—è –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è</div>
            </div>

            <div class="time-display">
                <span id="currentTime">0:00</span>
                <span id="duration">--:--</span>
            </div>

            <div class="status-message" id="statusMessage">
                üîä –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ 9:00
            </div>
        </div>
    </div>

    <!-- –ü—Ä–∏—Ö–æ–≤–∞–Ω–µ –≤—ñ–¥–µ–æ –¥–ª—è iOS -->
    <video class="hidden-video" id="hiddenVideo" loop playsinline muted>
        <source src="data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC" type="video/mp4">
    </video>

    <!-- –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ GitHub -->
    <a href="https://github.com/Carbon6600/minute-of-silence" target="_blank" class="github-link" aria-label="–í—ñ–¥–∫—Ä–∏—Ç–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π –Ω–∞ GitHub">
        <svg class="github-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
        </svg>
        <span class="github-text">GitHub</span>
    </a>

    <div class="sync-status">
        <span>NTP:</span>
        <div class="sync-dot" id="syncDot"></div>
        <span id="syncText">...</span>
    </div>

    <audio id="audioPlayer" preload="auto" crossorigin="anonymous">
        <source src="./silence.mp3" type="audio/mpeg">
        <source src="silence.mp3" type="audio/mpeg">
        –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î –∞—É–¥—ñ–æ.
    </audio>

    <script>
        const CONFIG = {
            targetHour: 9,
            targetMinute: 0,
            timeZone: 'Europe/Kiev',
            ntpServers: [
                'https://worldtimeapi.org/api/timezone/Europe/Kiev',
                'https://timeapi.io/api/Time/current/zone?timeZone=Europe/Kiev'
            ]
        };

        let state = {
            timeOffset: 0,
            isPlaying: false,
            hasAutoPlayedToday: false,
            lastCheckDate: null,
            audioLoaded: false,
            audioContext: null,
            analyser: null,
            dataArray: null,
            canvas: null,
            ctx: null,
            animationId: null,
            wakeLock: null,
            isWakeLockActive: false
        };

        // Wake Lock API
        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    state.wakeLock = await navigator.wakeLock.request('screen');
                    state.isWakeLockActive = true;
                    updateWakeLockStatus(true, 'API');
                    
                    state.wakeLock.addEventListener('release', () => {
                        state.isWakeLockActive = false;
                        updateWakeLockStatus(false, 'API');
                    });
                } else {
                    enableIOSWakeLock();
                }
            } catch (err) {
                console.log('Wake Lock –Ω–µ –≤–¥–∞–ª–æ—Å—è:', err);
                enableIOSWakeLock();
            }
        }

        function enableIOSWakeLock() {
            const video = document.getElementById('hiddenVideo');
            if (video) {
                video.play().then(() => {
                    state.isWakeLockActive = true;
                    updateWakeLockStatus(true, 'Video');
                }).catch(() => {
                    updateWakeLockStatus(false, '–ù–µ–º–∞—î');
                });
            }
        }

        function releaseWakeLock() {
            if (state.wakeLock) {
                state.wakeLock.release();
                state.wakeLock = null;
            }
            const video = document.getElementById('hiddenVideo');
            if (video) {
                video.pause();
            }
            state.isWakeLockActive = false;
            updateWakeLockStatus(false, '–ê–≤—Ç–æ');
        }

        function updateWakeLockStatus(active, type) {
            const statusEl = document.getElementById('wakelockStatus');
            const dotEl = document.getElementById('wakelockDot');
            const textEl = document.getElementById('wakelockText');
            
            statusEl.classList.add('active');
            dotEl.classList.toggle('on', active);
            textEl.textContent = active ? '–£–≤—ñ–º–∫.' : type;
        }

        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                if (state.wakeLock) {
                    updateWakeLockStatus(false, '–§–æ–Ω');
                }
            } else {
                requestWakeLock();
            }
        });

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Canvas
        function initVisualizer() {
            state.canvas = document.getElementById('visualizer');
            state.ctx = state.canvas.getContext('2d');
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            drawStaticWave();
        }

        function resizeCanvas() {
            const container = document.getElementById('visualizerContainer');
            state.canvas.width = container.offsetWidth;
            state.canvas.height = container.offsetHeight;
            if (!state.isPlaying) drawStaticWave();
        }

        function drawStaticWave() {
            const ctx = state.ctx;
            const width = state.canvas.width;
            const height = state.canvas.height;
            
            ctx.clearRect(0, 0, width, height);
            ctx.fillStyle = '#f50';
            
            const barWidth = 3;
            const gap = 2;
            const bars = Math.floor(width / (barWidth + gap));
            const centerY = height / 2;
            
            for (let i = 0; i < bars; i++) {
                const x = i * (barWidth + gap);
                const waveHeight = Math.sin(i * 0.1) * 5 + 3;
                ctx.fillRect(x, centerY - waveHeight/2, barWidth, waveHeight);
            }
            
            // –û–Ω–æ–≤–ª—é—î–º–æ –ø–æ–∑–∏—Ü—ñ—é –ø—Ä–æ–≥—Ä–µ—Å-–ª—ñ–Ω—ñ—ó –Ω–∞–≤—ñ—Ç—å –∫–æ–ª–∏ –ø–∞—É–∑–∞
            updateProgressLine();
        }

        function updateProgressLine() {
            const audio = document.getElementById('audioPlayer');
            const progressLine = document.getElementById('progressLine');
            
            if (audio.duration) {
                const progress = (audio.currentTime / audio.duration) * 100;
                progressLine.style.left = progress + '%';
            }
        }

        function animateVisualizer() {
            if (!state.isPlaying || !state.analyser) {
                drawStaticWave();
                return;
            }

            const ctx = state.ctx;
            const width = state.canvas.width;
            const height = state.canvas.height;
            
            state.analyser.getByteFrequencyData(state.dataArray);
            
            ctx.clearRect(0, 0, width, height);
            
            const barWidth = Math.max(3, width / 100);
            const gap = 2;
            const bars = Math.min(100, Math.floor(width / (barWidth + gap)));
            const step = Math.floor(state.dataArray.length / bars);
            
            const gradient = ctx.createLinearGradient(0, height, 0, 0);
            gradient.addColorStop(0, '#f50');
            gradient.addColorStop(0.5, '#ff8533');
            gradient.addColorStop(1, '#ffb380');
            
            ctx.fillStyle = gradient;
            
            for (let i = 0; i < bars; i++) {
                const dataIndex = i * step;
                const value = state.dataArray[dataIndex];
                const percent = value / 255;
                const barHeight = percent * height * 0.9;
                
                const x = i * (barWidth + gap);
                const y = (height - barHeight) / 2;
                
                ctx.beginPath();
                ctx.roundRect(x, y, barWidth, Math.max(barHeight, 4), 2);
                ctx.fill();
            }
            
            // –û–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–æ–≥—Ä–µ—Å-–ª—ñ–Ω—ñ—é –ø—ñ–¥ —á–∞—Å –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è
            updateProgressLine();
            updateTimeDisplay();
            
            state.animationId = requestAnimationFrame(animateVisualizer);
        }

        function setupAudioContext() {
            const audio = document.getElementById('audioPlayer');
            
            if (!state.audioContext) {
                state.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                state.analyser = state.audioContext.createAnalyser();
                state.analyser.fftSize = 256;
                
                const source = state.audioContext.createMediaElementSource(audio);
                source.connect(state.analyser);
                state.analyser.connect(state.audioContext.destination);
                
                state.dataArray = new Uint8Array(state.analyser.frequencyBinCount);
            }
            
            if (state.audioContext.state === 'suspended') {
                state.audioContext.resume();
            }
        }

        async function syncTime() {
            const syncDot = document.getElementById('syncDot');
            const syncText = document.getElementById('syncText');
            
            syncDot.className = 'sync-dot syncing';
            syncText.textContent = '...';

            try {
                let serverTime = null;
                
                for (const server of CONFIG.ntpServers) {
                    try {
                        const controller = new AbortController();
                        const timeoutId = setTimeout(() => controller.abort(), 5000);
                        
                        const startTime = Date.now();
                        const response = await fetch(server, { signal: controller.signal });
                        clearTimeout(timeoutId);
                        
                        const data = await response.json();
                        const endTime = Date.now();
                        const latency = (endTime - startTime) / 2;
                        
                        if (server.includes('worldtimeapi')) {
                            serverTime = new Date(data.utc_datetime).getTime() + latency;
                        } else if (server.includes('timeapi.io')) {
                            serverTime = new Date(data.dateTime).getTime() + latency;
                        }
                        
                        if (serverTime) break;
                    } catch (e) {
                        continue;
                    }
                }

                if (serverTime) {
                    state.timeOffset = serverTime - Date.now();
                    syncDot.className = 'sync-dot synced';
                    syncText.textContent = 'OK';
                } else {
                    throw new Error('–ù–µ–º–∞—î –∑\'—î–¥–Ω–∞–Ω–Ω—è');
                }
            } catch (error) {
                syncDot.className = 'sync-dot';
                syncText.textContent = 'Local';
                state.timeOffset = 0;
            }
        }

        function getKyivTime() {
            const now = new Date(Date.now() + state.timeOffset);
            const kyivTime = new Date(now.toLocaleString("en-US", {timeZone: "Europe/Kiev"}));
            return kyivTime;
        }

        function formatTime(date) {
            return date.toLocaleTimeString('uk-UA', { 
                hour12: false, 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit'
            });
        }

        function formatDate(date) {
            return date.toLocaleDateString('uk-UA', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric'
            });
        }

        function updateClock() {
            const kyivTime = getKyivTime();
            document.getElementById('clock').textContent = formatTime(kyivTime);
            document.getElementById('date').textContent = formatDate(kyivTime);
            checkAutoPlay(kyivTime);
        }

        function checkAutoPlay(kyivTime) {
            const currentHour = kyivTime.getHours();
            const currentMinute = kyivTime.getMinutes();
            const currentDate = kyivTime.toDateString();

            if (state.lastCheckDate !== currentDate) {
                state.hasAutoPlayedToday = false;
                state.lastCheckDate = currentDate;
                document.getElementById('statusMessage').classList.remove('active');
            }

            if (!state.hasAutoPlayedToday && 
                currentHour === CONFIG.targetHour && 
                currentMinute === CONFIG.targetMinute &&
                state.audioLoaded) {
                
                playAudio();
                state.hasAutoPlayedToday = true;
                document.getElementById('statusMessage').classList.add('active');
                document.getElementById('statusMessage').textContent = 'üîä –ó–∞—Ä–∞–∑ –≥—Ä–∞—î —Ö–≤–∏–ª–∏–Ω–∞ –º–æ–≤—á–∞–Ω–Ω—è';
            }
        }

        function updateTimeDisplay() {
            const audio = document.getElementById('audioPlayer');
            if (audio.duration) {
                document.getElementById('currentTime').textContent = formatAudioTime(audio.currentTime);
                document.getElementById('duration').textContent = formatAudioTime(audio.duration);
            }
        }

        function formatAudioTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // –ü–ï–†–ï–ú–û–¢–ö–ê ‚Äî –∫–ª—ñ–∫ –Ω–∞ –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ç–æ—Ä
        function seekAudio(e) {
            const audio = document.getElementById('audioPlayer');
            const container = document.getElementById('visualizerContainer');
            const rect = container.getBoundingClientRect();
            
            // –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —ñ –º–∏—à—ñ, —ñ —Ç–æ—Ä–∫–∞–Ω–Ω—è
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const x = clientX - rect.left;
            const percent = Math.max(0, Math.min(1, x / rect.width));
            
            if (audio.duration) {
                audio.currentTime = percent * audio.duration;
                updateProgressLine();
                updateTimeDisplay();
                
                // –í—ñ–±—Ä–∞—Ü—ñ—è –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö
                if ('vibrate' in navigator) {
                    navigator.vibrate(20);
                }
            }
        }

        function playAudio() {
            const audio = document.getElementById('audioPlayer');
            const btn = document.getElementById('playBtn');
            const container = document.getElementById('visualizerContainer');
            
            if (!state.audioLoaded) return;
            
            setupAudioContext();
            requestWakeLock();
            
            audio.play().then(() => {
                state.isPlaying = true;
                btn.textContent = '‚è∏';
                container.classList.add('playing');
                animateVisualizer();
            }).catch(err => {
                if (err.name === 'NotAllowedError') {
                    document.getElementById('statusMessage').textContent = 
                        '‚ö†Ô∏è –¢–æ—Ä–∫–Ω—ñ—Ç—å—Å—è Play –¥–ª—è –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è';
                    document.getElementById('statusMessage').classList.add('active');
                }
            });
        }

        function pauseAudio() {
            const audio = document.getElementById('audioPlayer');
            const btn = document.getElementById('playBtn');
            const container = document.getElementById('visualizerContainer');
            
            audio.pause();
            state.isPlaying = false;
            btn.textContent = '‚ñ∂';
            container.classList.remove('playing');
            cancelAnimationFrame(state.animationId);
            drawStaticWave();
        }

        function togglePlay() {
            if (state.isPlaying) {
                pauseAudio();
            } else {
                playAudio();
            }
        }

        function init() {
            initVisualizer();
            requestWakeLock();
            
            const audio = document.getElementById('audioPlayer');
            const btn = document.getElementById('playBtn');
            const visualizerContainer = document.getElementById('visualizerContainer');
            
            audio.addEventListener('canplaythrough', () => {
                state.audioLoaded = true;
                document.getElementById('duration').textContent = formatAudioTime(audio.duration);
            }, { once: true });
            
            audio.addEventListener('error', () => {
                btn.disabled = true;
            });
            
            audio.addEventListener('ended', () => {
                pauseAudio();
            });
            
            // –û–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–æ–≥—Ä–µ—Å –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –º–µ—Ç–∞–¥–∞–Ω–∏—Ö
            audio.addEventListener('loadedmetadata', () => {
                updateProgressLine();
            });
            
            audio.load();
            
            // –ö–Ω–æ–ø–∫–∞ Play/Pause
            btn.addEventListener('click', togglePlay);
            
            btn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                btn.style.transform = 'scale(0.95)';
            }, { passive: false });
            
            btn.addEventListener('touchend', (e) => {
                e.preventDefault();
                btn.style.transform = '';
                togglePlay();
            });
            
            // –ü–ï–†–ï–ú–û–¢–ö–ê ‚Äî –∫–ª—ñ–∫ —ñ —Å–≤–∞–π–ø –ø–æ –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ç–æ—Ä—É
            visualizerContainer.addEventListener('click', seekAudio);
            visualizerContainer.addEventListener('touchstart', (e) => {
                e.preventDefault();
                seekAudio(e);
            }, { passive: false });
            
            // –°–≤–∞–π–ø –¥–ª—è –ø–µ—Ä–µ–º–æ—Ç–∫–∏ (touchmove)
            let isDragging = false;
            
            visualizerContainer.addEventListener('touchmove', (e) => {
                e.preventDefault();
                isDragging = true;
                seekAudio(e);
            }, { passive: false });
            
            visualizerContainer.addEventListener('touchend', () => {
                isDragging = false;
            });
            
            // –ú–∏—à–∞ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø—É
            visualizerContainer.addEventListener('mousedown', () => {
                isDragging = true;
            });
            
            visualizerContainer.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    seekAudio(e);
                }
            });
            
            visualizerContainer.addEventListener('mouseup', () => {
                isDragging = false;
            });
            
            visualizerContainer.addEventListener('mouseleave', () => {
                isDragging = false;
            });
            
            if ('vibrate' in navigator) {
                btn.addEventListener('click', () => navigator.vibrate(50));
            }
            
            syncTime().then(() => {
                setInterval(updateClock, 1000);
                updateClock();
                setInterval(syncTime, 300000);
            });
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
